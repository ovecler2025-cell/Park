<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Park Faaliyet Basit</title>
<script type="module">
  // Firebase SDK import
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { getDatabase, ref, push, get } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";
  import { getStorage, ref as sRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-storage.js";

  // Güncel Firebase konfigürasyonu
  const firebaseConfig = {
    apiKey: "AIzaSyDjfdTH0AAcxh306fsa6Y-bQY5hD1H9C98",
    authDomain: "notlar-6b203.firebaseapp.com",
    databaseURL: "https://notlar-6b203-default-rtdb.firebaseio.com",
    projectId: "notlar-6b203",
    storageBucket: "notlar-6b203.appspot.com",
    messagingSenderId: "207248627620",
    appId: "1:207248627620:web:dc7ca324b18a8b9afad331"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const storage = getStorage(app);

  // Yeni kayıt ekleme fonksiyonu
  window.addEntry = async function() {
    const fileInput = document.getElementById("resim");
    const descInput = document.getElementById("aciklama");
    const dateInput = document.getElementById("tarih");

    if (!fileInput.files[0] || !descInput.value || !dateInput.value) {
      alert("Tüm alanları doldurun!");
      return;
    }

    const file = fileInput.files[0];
    const storageRef = sRef(storage, 'resimler/' + Date.now() + "_" + file.name);
    await uploadBytes(storageRef, file);
    const url = await getDownloadURL(storageRef);

    const newEntryRef = push(ref(db, 'parkFaaliyetleri'));
    await newEntryRef.set({
      tarih: dateInput.value,
      aciklama: descInput.value,
      resimUrl: url
    });

    alert("Kayıt başarılı!");
    loadEntries();
  }

  // Kayıtları listeleme fonksiyonu
  window.loadEntries = async function() {
    const list = document.getElementById("liste");
    list.innerHTML = "";
    const snapshot = await get(ref(db, 'parkFaaliyetleri'));
    if (snapshot.exists()) {
      const data = snapshot.val();
      Object.values(data).forEach(entry => {
        const div = document.createElement("div");
        div.style.border = "1px solid #ccc";
        div.style.margin = "5px";
        div.style.padding = "5px";
        div.innerHTML = `
          <strong>Tarih:</strong> ${entry.tarih}<br>
          <strong>Açıklama:</strong> ${entry.aciklama}<br>
          <img src="${entry.resimUrl}" width="150">
        `;
        list.appendChild(div);
      });
    }
  }

  window.onload = loadEntries;
</script>
</head>
<body>
<h2>Faaliyet Ekle</h2>
<label>Resim:</label>
<input type="file" id="resim" accept="image/*"><br><br>
<label>Açıklama:</label>
<input type="text" id="aciklama"><br><br>
<label>Tarih:</label>
<input type="date" id="tarih"><br><br>
<button onclick="addEntry()">Kaydet</button>

<h2>Kaydedilenler</h2>
<div id="liste"></div>
</body>
</html>
